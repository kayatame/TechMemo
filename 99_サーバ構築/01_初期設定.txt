○ rootユーザパスワード
# passwd

Red Hat Documentation (root パスワードの変更およびリセット)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/9/html/configuring_basic_system_settings/changing-and-resetting-the-root-password-from-the-command-line_managing-users-and-groups)


○ IP許可設定
# firewall-cmd --list-all
# firewall-cmd --permanent --zone=trusted --add-source=***.***.***.***
# firewall-cmd --reload
# firewall-cmd --permanent --list-all --zone=trusted

# firewall-cmd --permanent --remove-service=cockpit
# firewall-cmd --permanent --remove-service=dhcpv6-client
# firewall-cmd --permanent --remove-service=ssh
# firewall-cmd --reload
# firewall-cmd --permanent --list-all

Red Hat Documentation (firewalld の使用および設定)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/8/html/system_design_guide/using-and-configuring-firewalld_system-design-guide


○ ホストネーム変更
# hostnamectl
# hostnamectl set-hostname hogehoge
# hostnamectl

Red Hat Documentation (ホストシステムの名前変更)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/9/html/installing_identity_management/renaming-the-ipa-client-system_renaming-clients


○ タイムゾーン
# timedatectl
# timedatectl list-timezones | grep "Asia/Tokyo"
# timedatectl set-timezone Asia/Tokyo
# timedatectl

Red Hat Documentation (日付と時刻の設定)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/7/html/system_administrators_guide/chap-configuring_the_date_and_time#chap-Configuring_the_Date_and_Time


○ ロケール設定
# localectl status
# localectl list-locales | grep "ja"
# dnf install glibc-langpack-ja
# localectl set-locale ja_JP.UTF-8
# localectl status

Red Hat Documentation (システムロケールの設定)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/9/html/configuring_basic_system_settings/proc_configuring-the-system-locale_assembly_changing-basic-environment-settings

日本語パッケージインストール
https://dev.classmethod.jp/articles/set-locale-on-rhel-8/


○ キーボード設定
# localectl status
# localectl list-keymaps | grep "jp"
# localectl set-keymap jp
# localectl status

Red Hat Documentation (キーボードレイアウトの設定)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/9/html/configuring_basic_system_settings/proc_configuring-the-keyboard-layout_assembly_changing-basic-environment-settings


○ スワップファイル作成
# dd if=/dev/zero of=/swapfile bs=1MB count=4096
# mkswap /swapfile
# chmod 0600 /swapfile
# ll /swapfile

# cp -ip /etc/fstab{,.org}
# vi /etc/fstab
---------------------------------
/swapfile none swap defaults 0 0
---------------------------------
# diff /etc/fstab{,.org}

# systemctl daemon-reload
# swapon /swapfile
# mount -a
# cat /proc/swaps
# free -m

Red Hat Documentation (スワップファイルの作成)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/9/html/managing_storage_devices/creating-a-swap-file_getting-started-with-swap  

Red Hat Documentation (システムの推奨スワップ領域)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/9/html/managing_storage_devices/recommended-system-swap-space_getting-started-with-swap  


○ swappinessの調整
# sysctl vm.swappiness
# cp -ip /etc/sysctl.conf{,.org}
# vi /etc/sysctl.conf
------------------
vm.swappiness=10
------------------
# diff /etc/sysctl.conf{,.org}
# sysctl -p
# sysctl vm.swappiness

Red Hat Documentation (永続的なカーネルチューニングパラメーターの設定)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux_for_real_time/9/html/optimizing_rhel_9_for_real_time_for_low_latency_operation/setting-persistent-tuning-parameters_optimizing-rhel9-for-real-time-for-low-latency-operation#setting-persistent-tuning-parameters_optimizing-RHEL9-for-real-time-for-low-latency-operation 

最適値はスペックや使用用途に依存するので一概にいえない  
Red Hat Documentation (仮想メモリーパラメーター)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/virtual-memory-parameters_configuring-an-operating-system-to-optimize-memory-access  
Red Hat Documentation (Tuning Virtual Memory)
https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/6/html/performance_tuning_guide/s-memory-tunables  
スワップの弁護：よくある誤解を解く
https://chrisdown.name/ja/2018/01/02/in-defence-of-swap.html


○ SELinux設定
# getenforce
# grubby --update-kernel ALL --args selinux=0

Red Hat Documentation (SELinux の無効化)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/9/html/using_selinux/enabling_and_disabling_selinux-disabling_selinux_changing-selinux-states-and-modes

・設定変更後はサーバ再起動が必要
・カーネルをアップデートすると設定が上書きされることに注意

# cat /proc/cmdline
# grubby --info /boot/vmlinuz-5.14.0-427.13.1.el9_4.x86_64

・RHEL9系に場合は、 /etc/selinux/config での無効化は非推奨  
RHEL9での変更点(セキュリティ編：Part1 SELinuxの無効化について)
https://security.sios.jp/security/rhel9-security-part1-selinux/
RHEL9での変更点(セキュリティ編：Part2 SELinuxのパフォーマンス向上について)
https://security.sios.jp/security/rhel9-security-part2-selinux/

・disabledは非推奨なので、Permissiveが好ましい  
Red Hat Documentation (SELinux の Permissive モードへの変更)
https://access.redhat.com/documentation/ja-jp/red_hat_enterprise_linux/9/html/using_selinux/changing-to-permissive-mode_changing-selinux-states-and-modes

・RHEL8の場合は従来通りの設定で問題なし ※/etc/selinux/configの設定のみ  
Red Hat Documentation (SELinux の無効化)
https://access.redhat.com/documentation/ja-jp/red_hat_enterprise_linux/8/html/using_selinux/enabling_and_disabling_selinux-disabling_selinux_changing-selinux-states-and-modes

・さくらのクラウドの場合、AlmaLinux9は最初からdisabledとなっている  
RHEL9では非推奨である、/etc/selinux/configで調整している  
AlmaLinuxとRHELで挙動が違うのか、さくら側で調整しているのかは不明  
さくらのクラウド マニュアル(AlmaLinux 9.0 64bit リリースノート)
https://manual.sakura.ad.jp/cloud/server/os-packages/archive-iso/alma90-releasenote.html


○ SSHユーザ作成
# useradd user
# passwd user

# su - user
$ ssh-keygen -t ed25519 -C ""
$ mv .ssh/id_ed25519.pub .ssh/authorized_keys
$ chmod 600 .ssh/authorized_keys
$ ll .ssh/

秘密鍵は保存した後に削除しておく
# rm /home/user/.ssh/id_ed25519


○ sudo権限調整
# visudo -f /etc/sudoers.d/user
---------------------------------------------------------
user ALL=(ALL) NOPASSWD: ALL
---------------------------------------------------------


○ sshd設定調整
# cp -ip /etc/ssh/sshd_config{,.org}
# vi /etc/ssh/sshd_config
----------------------------------------------------------------------------------------
PasswordAuthentication no
PermitRootLogin no
Subsystem     sftp    /usr/libexec/openssh/sftp-server -u 002 -f local5 -l VERBOSE
----------------------------------------------------------------------------------------
# diff /etc/ssh/sshd_config{,.org}

# sshd -t
# systemctl status sshd
# systemctl restart sshd

Red Hat Documentation (OpenSSH のセキュリティーの強化)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/9/html/configuring_basic_system_settings/making-openssh-more-secure_assembly_using-secure-communications-between-two-systems-with-openssh 


○ SFTPロギング
# mkdir /var/log/sftp/
# vi /etc/rsyslog.d/sftp.conf
----------------------------------------------------
local5.*        /var/log/sftp/sftp.log
----------------------------------------------------
# systemctl restart rsyslog

# cp -ip /etc/logrotate.d/rsyslog /home/user/logrotate_rsyslog.org
# vi /etc/logrotate.d/rsyslog
---------------------------------------------------
/var/log/sftp/sftp.log   #ローテート対象に追加
---------------------------------------------------


○ パッケージインストール
# dnf install bind-utils wget sysstat s-nail net-tools yum-utils gcc make tcpdump lsof unzip traceroute vim-enhanced telnet dstat man-pages nmap nmap-ncat

・Red Hat Enterprise Linux 8場合  
　「s-nail」ではなく「mailx」  
　「powertools」から「nfk」コマンドのインストールが可能


○ dnf upgrade
# dnf upgrade

Red Hat Documentation (パッケージの更新)
https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/9/html/managing_software_with_the_dnf_tool/proc_updating-packages-with-yum_assembly_updating-rhel-9-content  


○ 再起動
# reboot
# uptime
# hostnamectl
# timedatectl
# localectl status
# free -m
# getenforce
